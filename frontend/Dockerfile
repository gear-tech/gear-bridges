FROM node:18-alpine
MAINTAINER gear

WORKDIR /app

COPY ./frontend .

RUN apk update

RUN apk add xsel

ARG VITE_VARA_NODE_ADDRESS \
    VITE_ETH_NODE_ADDRESS \
    VITE_ETH_CHAIN_ID \
    VITE_WALLET_CONNECT_PROJECT_ID \
    VITE_INDEXER_ADDRESS \
    VITE_BRIDGING_PAYMENT_CONTRACT_ADDRESS \
    VITE_VFT_MANAGER_CONTRACT_ADDRESS \
    VITE_ETH_BRIDGING_PAYMENT_CONTRACT_ADDRESS \
    VITE_ERC20_MANAGER_CONTRACT_ADDRESS \
    VITE_TOKEN_PRICE_API_URL \
    VITE_FAUCET_API_URL \
    VITE_HCAPTCHA_SITEKEY \
    VITE_GTM_ID

ENV VITE_VARA_NODE_ADDRESS=${VITE_VARA_NODE_ADDRESS} \
    VITE_ETH_NODE_ADDRESS=${VITE_ETH_NODE_ADDRESS} \
    VITE_ETH_CHAIN_ID=${VITE_ETH_CHAIN_ID} \
    VITE_WALLET_CONNECT_PROJECT_ID=${VITE_WALLET_CONNECT_PROJECT_ID} \
    VITE_INDEXER_ADDRESS=${VITE_INDEXER_ADDRESS} \
    VITE_BRIDGING_PAYMENT_CONTRACT_ADDRESS=${VITE_BRIDGING_PAYMENT_CONTRACT_ADDRESS} \
    VITE_VFT_MANAGER_CONTRACT_ADDRESS=${VITE_VFT_MANAGER_CONTRACT_ADDRESS} \
    VITE_ETH_BRIDGING_PAYMENT_CONTRACT_ADDRESS=${VITE_ETH_BRIDGING_PAYMENT_CONTRACT_ADDRESS} \
    VITE_ERC20_MANAGER_CONTRACT_ADDRESS=${VITE_ERC20_MANAGER_CONTRACT_ADDRESS} \
    VITE_TOKEN_PRICE_API_URL=${VITE_TOKEN_PRICE_API_URL} \
    VITE_FAUCET_API_URL=${VITE_FAUCET_API_URL} \
    VITE_HCAPTCHA_SITEKEY=${VITE_HCAPTCHA_SITEKEY} \
    VITE_GTM_ID=${VITE_GTM_ID}

RUN npm install

RUN npm run build

RUN npm install --global serve

CMD ["serve", "-s", "/app/dist"]
